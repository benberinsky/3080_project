---
title: "Project Part 1" 
fontsize: 12pt
geometry: margin=1in
urlcolor: black
output: pdf_document
header-includes:
- \usepackage{setspace}
- \onehalfspacing
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, highlight=FALSE)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(ggplot2)
library(knitr)
```

## Introduction

Major League Baseball has long been divided into two separate but not identical leagues of the American League and the National League. One key distinction for decades set the two leagues apart in that only the American League allowed the use of the designated hitter which is a player who bats in place of the pitcher. In the 2022 season, the National League adopted the DH rule for the first time, marking a significant change in how both leagues approached offensive play. The American league historically had been better at hitting than the National league since their adoption of the Designated Hitter in 1973, and therefore ultimately led to the NL following in its path. The DH creates deeper lineups which are a bigger threat to opposing teams defenses. Instead of having an almost guaranteed out every time through the lineup they now have normally one of the best hitters on the team taking that spot.

The addition of the DH to the National League was one of the biggest changes to the game since the adoption of interleague play which took place in 1997. Before 1997, the AL and the NL only played each other in official games in the World Series. In 2023 the interleague policy was also updated to where teams now play 46 interleague games each season, this was an increase from the previous 20 games a team would play in the previous season. Each team plays every other team in the league at least once annually, with the schedule including 4 games against a rival interleague team and 3 games against the other 14 non-league opponents. The remaining games are 52 intradivision games which is 13 against each of the four divisional opponents and 64 intraleague games which are against the other ten teams in their own league. With these scheduling changes this decreases the issue of teams having easier schedules than other teams, an issue that leagues like the NFL face where each team does not play every team each year. as well as ensuring each team plays a more balanced and consistent set of opponents from both leagues throughout the season.

The changing in schedules and the addition of the DH to the National League is what drew us to looking at differences in league batting in the 2022 season. These changes have significant impact on baseball as a whole with it potentially giving leagues a better chance to succeed and win the World Series. We want to see if either league has statistically significant better hitters.

In our research project we are looking at three questions that test to see if league offence is significantly better comparing the National League to the American League.

### Questions:

1)  Did MLB players in the American league hit a significantly different number of home runs than players in the National League in 2022?
2)  Did MLB players in the American league have a significantly different batting average than players in the National League in 2022?
3)  Did MLB players in the American league have a significantly different number of at bats on average than those in the National league?

We chose home runs, batting average and number of at bats as our three test variables that we want to look at. We believe that these give a good summary of a teams offence because the way baseball is played in this current era, the homerun ball is a significant factor but high batting averages and number of at bats also plays a key role as it shows how fast a league is turning over the batting order and how productive they are being when a league’s player is at the plate.

## Data Summary

```{r}
NL<-read.csv("nl_batting_stats.csv")
AL<-read.csv("al_batting_stats.csv")

# Remove totals rows
AL <- AL[AL$Player != "Team Totals" & AL$Player != "League Totals", ]
NL <- NL[NL$Player != "Team Totals" & NL$Player != "League Totals", ]

# Filter out players with low AB to greater than 100)
AL <- AL[AL$AB >= 100, ]
NL <- NL[NL$AB >= 100, ]

# Convert batting average to numeric
AL$BA <- as.numeric(AL$BA)
NL$BA <- as.numeric(NL$BA)

# Remove rows with missing BA values
AL <- AL[!is.na(AL$BA), ]
NL <- NL[!is.na(NL$BA), ]

# Remove rows with missing HR values
AL <- AL[!is.na(AL$HR), ]
NL <- NL[!is.na(NL$HR), ]

# Combining df into one 
combined_data <- rbind(
  data.frame(League = "AL", AL),
  data.frame(League = "NL", NL)
)
```

For the data collection process of the project we retrieved our data from baseball-reference which is a database that compiles statistics of the MLB throughout the years. It is a highly trusted site and pulls its data from a variety of sources, but they pull from official MLB statistics and box scores using the MLB’s scoring system and this is the foundation of player performance metrics which we are using in our project. The data we are using represents the population because we pulled the batting statistics for all MLB players in the American League and National League for the 2022 season. We did not use any sampling methods because the data is of all the players that recorded statistics in the 2022 season. This would not be a sample because it includes everyone in the population of our research question. After we collected both the NL csv file and the Al csv file we cleaned the data by filtering out players with low at bats to make it so it is only players with greater than 100 at bats in the season. We did this because players with a very small number of at bats can add noise to the data set with their misleading batting averages. A player could go 1-2 for the season and have a .500 batting average and another player could go 200-500 for the year and have a batting average of .400. While the .500 is better, we don’t trust it because the sample size is 2 at bats. By getting rid of the plays that bat less than 100 times we are making our dataset better suited to compare the leagues.

The only potential issue that is not accounted for are ballparks that are historically easier to hit the ball in like Coors Field and Fenway Park. Those teams that play more often in those parks are more likely to perform better and that not only has a home team impact but also an intradivision and intraleague impact, since they will be playing there more often than those in the interleague. I believe this will not be an issue since there isn’t one division with significantly more hitter friendly ballparks. Despite this challenge, the data is appropriate for our research questions because it directly measures the batting performance metrics we are analyzing and it provides full coverage of the MLB population for the 2022 season

## Data Dictionary

| Column Name | Variable Name | Description |
|-------------|---------------|--------------------------------------------|
| PA | Plate Appearances | Number of times a player came up to bat (including walks and hit by pitches) |
| AB | At Bats | Number of times a player came up to bat (not including walks or hit by pitches) |
| H | Hits | Number of times a player got a hit in an at bat, which could be a single, double, triple, or home run |
| HR | Home Runs | Number of times a player hit a fair ball out of the stadium, resulting in them scoring as well as anyone else on base |
| RBI | Runs Batted In | Count of runners who scored as a result of a player's plate appearance (excluding double plays) |
| BA | Batting Average | A percentage value representing the proportion of at bats in which a player got a hit, calculated as hits/at bats |

## Data exploration

Summary statistics for batting average:
```{r}
ba_summary <- combined_data %>%
  group_by(League) %>%
  summarize(medba = median(BA, na.rm = TRUE),
            meanba = mean(BA, na.rm = TRUE),
            sdba = sd(BA, na.rm = TRUE),
            maxba = max(BA, na.rm = TRUE)) 
```

```{r}
ba_summary %>%kable(col.names =c("Leauge", "Median", "Mean", "StDev", "Maximum"),
        caption = "Batting Average Summary Statistics by League",
        digits = 3,
        align = "cccccc")
```

Summary statistics for home runs:
```{r}
hr_summary <- combined_data %>%
  group_by(League) %>%
  summarize(medhr = median(HR, na.rm = TRUE),
            meanhr = mean(HR, na.rm = TRUE),
            sdhr = sd(HR, na.rm = TRUE),
            maxhr = max(HR, na.rm = TRUE)) 
```

```{r}
hr_summary %>%kable(col.names =c("Leauge", "Median", "Mean", "StDev", "Maximum"),
        caption = "Home Run Summary Statistics by League",
        digits = 1,
        align = "cccccc")
```

Summary statistics for at bats:
```{r}
ab_summary <- combined_data %>%
  group_by(League) %>%
  summarize(medab = median(AB, na.rm = TRUE),
            meanab = mean(AB, na.rm = TRUE),
            sdab = sd(AB, na.rm = TRUE),
            maxab = max(AB, na.rm = TRUE)) 
```

```{r}
ab_summary %>%kable(col.names =c("Leauge", "Median", "Mean", "StDev", "Maximum"),
        caption = "Batting Average Summary Statistics by League",
        digits = 1,
        align = "cccccc")
```
Total Home Runs by League:
```{r}
total_HR_AL <- sum(AL$HR)
total_HR_NL <- sum(NL$HR)
cat("AL Home Run Totals:", total_HR_AL, "\n")
cat("NL Home Run Totals:", total_HR_NL, "\n")
```

Overlayed Histograms - Distribution of batting average (BA) for NL vs AL players
```{r, echo=FALSE}
ggplot() +
  geom_histogram(data = AL, aes(x = BA, fill = "AL"), alpha = 0.5, position = "identity", bins = 20) +
  geom_histogram(data = NL, aes(x = BA, fill = "NL"), alpha = 0.5, position = "identity", bins = 20) +
  labs(title = "Distribution of Batting Average (BA) for NL vs AL Players",
       x = "Batting Average (BA)",
       y = "Count") +
  scale_fill_manual(name = "League", values = c("AL" = "blue", "NL" = "red")) +
  theme_minimal()
```

Scatterplot of At Bats vs. Batting Average for NL and AL players
```{r, echo=FALSE}
ggplot() +
  geom_point(data = AL, aes(x = AB, y = BA, color = "AL"), alpha = 0.6) +
  geom_point(data = NL, aes(x = AB, y = BA, color = "NL"), alpha = 0.6) +
  labs(title = "At Bats (AB) vs Batting Average (BA) for NL and AL Players",
       x = "At Bats (AB)",
       y = "Batting Average (BA)") +
  scale_color_manual(name = "League", values = c("AL" = "blue", "NL" = "red")) +
  theme_minimal()
```
Boxplot - Home Runs (HR) for NL vs AL players
```{r, echo=FALSE}
ggplot() +
  geom_boxplot(data = AL, aes(x = "AL", y = HR, fill = "AL"), alpha = 0.5) +
  geom_boxplot(data = NL, aes(x = "NL", y = HR, fill = "NL"), alpha = 0.5) +
  labs(title = "Boxplot of Home Runs (HR) for NL vs AL Players",
       x = "League",
       y = "Home Runs (HR)") +
  scale_fill_manual(name = "League", values = c("AL" = "blue", "NL" = "red")) +
  theme_minimal()
```
Boxplot of batting average by leauge
```{r, echo=FALSE}
ggplot(combined_data, aes(x = League, y = BA, fill = League)) +
  geom_boxplot(alpha = 0.7) +
  labs(title = "Boxplot of Batting Average (BA) by League",
       x = "League",
       y = "Batting Average (BA)") +
  scale_fill_manual(values = c("AL" = "blue", "NL" = "red")) +
  theme_minimal()
```


## Conclusions

The four summary statistics show the leagues to be very comparable in batting averages, at bats, and home runs. For starters, the summary comparing batting averages of AL and NL players shows the leagues to be similar. However, while all values are within .0300 of each other, the National League shows slightly higher percentages across the board, suggesting NL hitters may be slightly more efficient than those in the AL. The summary of home run statistics show a similar story, with the values being very similar between the leagues asides from the NL having a higher maximum number of home runs. The total number of home runs in each league are within 5%, but the NL takes the lead with players hitting 118 more home runs than their AL counterparts. Interestingly, for at bats, the AL has a higher median and mean than the NL, suggesting that despite lower batting averages and home runs hit, American League batters are stepping up to the plate more often. 

Figure 1 showing the distribution of batting averages for AL and NL players confirms the statistical summary. Both leagues have a similar mean, median, and spread when it comes to player batting averages. Notably, however, the AL has more players with a batting average less than .150, and the National League has more players with a batting average greater than .325. These skews may be important to look at further along. Figure 2, the graph of batting average against at bats, gives us more information, as the positive trend suggests players with more at bats have a higher batting average. This stat holds true for both leagues, and makes sense considering players with more at bats are likely better get more head-to-head experience than bench players or pinch hitters that have less at bats. Lastly, Figure 3 showing box plots of AL and NL home runs confirms the statistical summary given. Both leagues are very similar, with the National League  having more outlying batters with lots of home runs, also lending to the greater spread of the IQR.

With these data summaries and visualizations, it appears that AL and NL batters are similar in many key areas. However, there are some slight differences to consider. For example, the fact that AL hitters tend to get more plate appearances, or that NL batters tend to have a higher batting average. With this in mind, it is important to do more statistical analysis and modeling to understand if these differences are due to specific players, or come from the history and state of the two leagues.

## Data appendix

```{r}
# Printing a readable output of combined data as a tibble, first 15 rows:
combined_data %>% as_tibble() %>% head(15)
```

